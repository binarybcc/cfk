# üöÄ v1.4 Alpine.js - Production Deployment Guide

**Version:** 1.4.0
**Branch:** v1.4-alpine-js-enhancement
**Deployment Date:** October 11, 2025
**Target Server:** cforkids.org (d646a74eb9.nxcli.io)

---

## üìã Pre-Deployment Checklist

### ‚úÖ Preparation (Complete Before Deployment)

- [ ] **Backup production database**
  ```bash
  ssh a4409d26_1@d646a74eb9.nxcli.io
  cd ~/d646a74eb9.nxcli.io/html/
  mysqldump -u a4409d26_509946 -p a4409d26_509946 > backup_pre_v1.4_$(date +%Y%m%d_%H%M%S).sql
  ```

- [ ] **Backup production files**
  ```bash
  tar -czf backup_files_pre_v1.4_$(date +%Y%m%d_%H%M%S).tar.gz \
    admin/ includes/ pages/ assets/ database/ config/
  ```

- [ ] **Test Alpine.js CDN accessibility**
  ```bash
  curl -I https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js
  # Should return: HTTP/2 200
  ```

- [ ] **Verify production database schema**
  ```sql
  USE a4409d26_509946;
  DESCRIBE families;
  -- Should NOT have family_name column
  ```

---

## üéØ What's Being Deployed

### New Features (Alpine.js v3.14.1)

1. **Instant Search & Filter** (pages/children.php)
   - Real-time search by family code, interests, wishes
   - Gender and age range filters
   - Live results counter
   - No page reloads

2. **FAQ Accordion** (pages/how_to_apply.php)
   - 8-question expandable FAQ section
   - Smooth animations with x-collapse
   - Toggle icons (+ / ‚àí)

3. **CSV Import Live Validation** (admin/import_csv.php)
   - Real-time file validation
   - File size checking (5MB limit)
   - Extension validation (.csv only)
   - Dynamic error/warning display

### Privacy Compliance Fixes

- ‚ùå **REMOVED:** All child names
- ‚ùå **REMOVED:** All family names (surnames)
- ‚úÖ **ADDED:** Family codes only (e.g., "175A")
- ‚úÖ **ADDED:** Generic age/gender-appropriate avatars

### Files Modified (18 total)

**Core Application:**
- `includes/header.php` - Alpine.js CDN added
- `includes/functions.php` - SQL queries updated (no names)
- `includes/sponsorship_manager.php` - Queries updated
- `includes/csv_handler.php` - Export updated
- `includes/archive_manager.php` - Queries updated
- `includes/components/child_card.php` - Display updated

**Admin Interface:**
- `admin/index.php` - Dashboard queries updated
- `admin/manage_children.php` - Queries updated (2 places)
- `admin/import_csv.php` - Alpine.js validation added

**Public Pages:**
- `pages/children.php` - Alpine.js instant search
- `pages/how_to_apply.php` - Alpine.js FAQ accordion
- `pages/sponsor_portal.php` - Display updated
- `pages/home.php` - Updated

**Database:**
- `database/schema.sql` - family_name column removed

**Assets:**
- `assets/images/` - 8 generic avatar images

**Config:**
- `config/config.production.php` - Production settings

---

## üì¶ Deployment Package Contents

```
cfk-v1.4-production.tar.gz
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ index.php
‚îÇ   ‚îú‚îÄ‚îÄ import_csv.php
‚îÇ   ‚îú‚îÄ‚îÄ manage_children.php
‚îÇ   ‚îî‚îÄ‚îÄ reports.php
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b-4boysm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b-4girlsm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elementaryboysm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ elementarygirlsm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleboysm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlegirlsm.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hsboysm.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hsgirlsm.png
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îú‚îÄ‚îÄ includes/
‚îÇ   ‚îú‚îÄ‚îÄ header.php
‚îÇ   ‚îú‚îÄ‚îÄ footer.php
‚îÇ   ‚îú‚îÄ‚îÄ functions.php
‚îÇ   ‚îú‚îÄ‚îÄ sponsorship_manager.php
‚îÇ   ‚îú‚îÄ‚îÄ csv_handler.php
‚îÇ   ‚îú‚îÄ‚îÄ archive_manager.php
‚îÇ   ‚îú‚îÄ‚îÄ import_analyzer.php
‚îÇ   ‚îú‚îÄ‚îÄ backup_manager.php
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îî‚îÄ‚îÄ child_card.php
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ children.php
‚îÇ   ‚îú‚îÄ‚îÄ how_to_apply.php
‚îÇ   ‚îú‚îÄ‚îÄ sponsor_portal.php
‚îÇ   ‚îî‚îÄ‚îÄ home.php
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ v1.4_remove_family_name.sql
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.production.php
‚îú‚îÄ‚îÄ index.php
‚îî‚îÄ‚îÄ DEPLOYMENT-INSTRUCTIONS.txt
```

---

## üöÄ Deployment Steps

### Step 1: Upload Deployment Package

```bash
# From local machine
scp cfk-v1.4-production.tar.gz a4409d26_1@d646a74eb9.nxcli.io:~/

# SSH to server
ssh a4409d26_1@d646a74eb9.nxcli.io
```

### Step 2: Backup Current Production

```bash
cd ~/d646a74eb9.nxcli.io/html/

# Create backup directory
mkdir -p ~/backups/pre-v1.4

# Backup database
mysqldump -u a4409d26_509946 -p'Fests42Cue50Fennel56Auk46' a4409d26_509946 \
  > ~/backups/pre-v1.4/database_$(date +%Y%m%d_%H%M%S).sql

# Backup files
tar -czf ~/backups/pre-v1.4/files_$(date +%Y%m%d_%H%M%S).tar.gz \
  admin/ includes/ pages/ assets/ database/

echo "‚úÖ Backup complete"
```

### Step 3: Database Migration

```bash
# Connect to MySQL
mysql -u a4409d26_509946 -p'Fests42Cue50Fennel56Auk46' a4409d26_509946

# Run migration (if family_name column exists)
ALTER TABLE families DROP COLUMN IF EXISTS family_name;

# Verify schema
DESCRIBE families;
-- Should show: id, family_number, notes, created_at, updated_at

# Exit MySQL
exit
```

### Step 4: Deploy Files

```bash
cd ~/d646a74eb9.nxcli.io/html/

# Extract deployment package
tar -xzf ~/cfk-v1.4-production.tar.gz -C .

# Set correct permissions
chmod 644 admin/*.php
chmod 644 includes/*.php
chmod 644 pages/*.php
chmod 644 config/*.php
chmod 644 assets/images/*.png
chmod 755 admin/ includes/ pages/ assets/ config/

echo "‚úÖ Files deployed"
```

### Step 5: Verify Alpine.js Integration

```bash
# Check Alpine.js is loaded in header
grep -n "alpinejs" includes/header.php

# Should show:
# <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>
```

### Step 6: Test Production

**Automated Tests:**
```bash
# Test Alpine.js CDN
curl -I https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js

# Test homepage loads
curl -I https://cforkids.org/sponsor/

# Test children page loads
curl -I https://cforkids.org/sponsor/?page=children
```

**Manual Tests:** (Use browser)

1. **Visit:** https://cforkids.org/sponsor/?page=children
   - ‚úÖ Search box works instantly
   - ‚úÖ Gender filter works
   - ‚úÖ Age slider works
   - ‚úÖ Results counter updates
   - ‚úÖ Generic avatars display
   - ‚úÖ No child names shown

2. **Visit:** https://cforkids.org/sponsor/?page=how_to_apply
   - ‚úÖ Scroll to FAQ section
   - ‚úÖ Click questions to expand/collapse
   - ‚úÖ Smooth animations
   - ‚úÖ Icons toggle (+/‚àí)

3. **Visit:** https://cforkids.org/sponsor/admin/import_csv.php
   - ‚úÖ File validation works
   - ‚úÖ Error messages display
   - ‚úÖ Submit button enables/disables

4. **Browser Console Check:**
   ```javascript
   Alpine.version
   // Should return: "3.14.1"
   ```

---

## üîç Post-Deployment Verification

### Critical Checks

```bash
# 1. Check for PHP errors
tail -50 ~/logs/error_log

# 2. Verify database connection
mysql -u a4409d26_509946 -p'Fests42Cue50Fennel56Auk46' \
  -e "SELECT COUNT(*) FROM a4409d26_509946.children;"

# 3. Check file permissions
ls -la ~/d646a74eb9.nxcli.io/html/includes/*.php

# 4. Verify Alpine.js loads
curl https://cforkids.org/sponsor/ | grep -o "alpinejs@3.14.1"
```

### Privacy Compliance Verification

```sql
-- Connect to database
mysql -u a4409d26_509946 -p'Fests42Cue50Fennel56Auk46' a4409d26_509946

-- Check families table has no name column
SHOW COLUMNS FROM families;
-- Should NOT show: family_name

-- Check children table has no name column
SHOW COLUMNS FROM children;
-- Should NOT show: first_name, last_name, name

-- Verify display_id is computed
SELECT
    CONCAT(f.family_number, c.child_letter) as display_id,
    c.age,
    c.gender,
    c.status
FROM children c
INNER JOIN families f ON c.family_id = f.id
LIMIT 5;

exit
```

---

## üêõ Troubleshooting

### Issue: Alpine.js Not Loading

**Symptoms:**
- Search doesn't filter
- FAQ doesn't expand
- CSV validation doesn't work

**Diagnosis:**
```bash
# Check Alpine.js CDN
curl -I https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js

# Check header.php has correct script tag
grep alpinejs includes/header.php
```

**Fix:**
```bash
# Verify header.php was deployed
ls -l includes/header.php

# Re-deploy if needed
cp ~/cfk-v1.4-production/includes/header.php includes/
```

### Issue: Database Errors (family_name not found)

**Symptoms:**
- SQL errors mentioning "family_name" or "Unknown column"
- Children page won't load

**Diagnosis:**
```sql
-- Check if old column exists
DESCRIBE families;
```

**Fix:**
```sql
-- Remove old column
ALTER TABLE families DROP COLUMN family_name;
```

### Issue: Search Not Filtering

**Symptoms:**
- Typing in search box does nothing
- Browser console shows JavaScript errors

**Diagnosis:**
```javascript
// Open browser console (F12)
// Type:
window.childrenData
// Should return: array of children objects

Alpine.version
// Should return: "3.14.1"
```

**Fix:**
- Clear browser cache (Cmd+Shift+R / Ctrl+F5)
- Check children.php was deployed correctly
- Verify JSON encoding in PHP

### Issue: Generic Avatars Not Displaying

**Symptoms:**
- Broken image icons on children cards
- Console shows 404 errors

**Diagnosis:**
```bash
# Check avatar images exist
ls -l assets/images/*.png

# Check file permissions
ls -la assets/images/
```

**Fix:**
```bash
# Re-upload avatar images
cd ~/d646a74eb9.nxcli.io/html/assets/images/
# Upload missing images via SFTP

# Set correct permissions
chmod 644 *.png
```

---

## ‚èÆÔ∏è Rollback Procedure

**If deployment fails, roll back immediately:**

### Quick Rollback (5 minutes)

```bash
cd ~/d646a74eb9.nxcli.io/html/

# 1. Restore database
mysql -u a4409d26_509946 -p'Fests42Cue50Fennel56Auk46' \
  a4409d26_509946 < ~/backups/pre-v1.4/database_*.sql

# 2. Restore files
rm -rf admin/ includes/ pages/ assets/ database/
tar -xzf ~/backups/pre-v1.4/files_*.tar.gz

# 3. Verify rollback
curl https://cforkids.org/sponsor/
```

### Verify Rollback Success

```bash
# Check homepage loads
curl -I https://cforkids.org/sponsor/

# Check old version (no Alpine.js)
curl https://cforkids.org/sponsor/ | grep -o "alpinejs"
# Should return nothing (Alpine.js not present in old version)
```

---

## üìä Success Metrics

**Deployment is successful when:**

- ‚úÖ All pages load without errors (200 status codes)
- ‚úÖ Alpine.js v3.14.1 loads in browser console
- ‚úÖ Instant search filters children in real-time
- ‚úÖ FAQ accordion expands/collapses smoothly
- ‚úÖ CSV validation works before upload
- ‚úÖ No child/family names displayed anywhere
- ‚úÖ Only family codes shown (e.g., "175A")
- ‚úÖ Generic avatars display correctly
- ‚úÖ No PHP errors in server logs
- ‚úÖ Database queries execute without errors

---

## üìû Support Contacts

**Technical Issues:**
- Developer: Claude Code
- Server: Hostinger (d646a74eb9.nxcli.io)
- Database: MySQL 8.0+

**Deployment Questions:**
- Review: `docs/V1.4-ALPINE-JS-COMPLETE.md`
- Testing: `docs/QUICK-TEST-GUIDE.md`
- Privacy: `docs/V2.0-DATABASE-PRIVACY-CLEANUP.md`

---

## üìù Deployment Log Template

```
===========================================
CFK v1.4 Alpine.js - Production Deployment
===========================================

Deployment Date: _______________
Deployed By: _______________
Start Time: _______________

PRE-DEPLOYMENT
--------------
[ ] Database backed up
[ ] Files backed up
[ ] Alpine.js CDN tested
[ ] Schema verified

DEPLOYMENT
----------
[ ] Package uploaded
[ ] Database migrated
[ ] Files deployed
[ ] Permissions set

POST-DEPLOYMENT
---------------
[ ] Instant search working
[ ] FAQ accordion working
[ ] CSV validation working
[ ] No names displayed
[ ] Generic avatars showing
[ ] Alpine.js loaded (v3.14.1)
[ ] No PHP errors
[ ] No console errors

TESTING
-------
[ ] Children page tested
[ ] How to Apply page tested
[ ] CSV Import page tested
[ ] Privacy compliance verified
[ ] Performance acceptable

End Time: _______________
Total Duration: _______________

Status: [ ] SUCCESS / [ ] ROLLBACK REQUIRED

Notes:
_______________________________________
_______________________________________
_______________________________________

Deployed by: _______________
Signature: _______________
```

---

## üéâ Next Steps After Deployment

1. **Monitor for 24 hours:**
   - Check server logs for errors
   - Monitor user feedback
   - Track performance metrics

2. **User Communication:**
   - Notify admins of new instant search feature
   - Update CSV import documentation
   - Share privacy compliance improvements

3. **Future Enhancements:**
   - Consider v1.5 features
   - Plan additional Alpine.js components
   - Optimize performance further

---

**Document Version:** 1.0
**Last Updated:** October 11, 2025
**Deployment Status:** Ready for Production

---

üöÄ **Ready to deploy? Follow steps 1-6 above!**
