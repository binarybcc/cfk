# v1.9.3 Quick Deployment Guide

**Quick reference for deploying v1.9.3 to staging**

---

## ðŸš€ One-Command Deployment (Coming Soon)

```bash
# Full deployment script (to be created)
./deploy-v1.9.3-to-staging.sh
```

---

## ðŸ“¦ Manual Deployment (Step-by-Step)

### Prerequisites
```bash
# 1. Verify staging credentials
cat .env.staging

# 2. Checkout v1.9.3
git checkout v1.9.3
git pull origin v1.9.3
```

### Deploy
```bash
# 3. Create package
DEPLOY_DATE=$(date +%Y%m%d-%H%M%S)
tar -czf "/tmp/cfk-v1.9.3-${DEPLOY_DATE}.tar.gz" \
  --exclude='.git*' --exclude='node_modules' \
  --exclude='.DS_Store' --exclude='*.log' \
  --exclude='vendor' --exclude='cache' .

# 4. Upload
source .env.staging
BASE_USER=$(echo "$SSH_USER" | cut -d'_' -f1)
sshpass -p "$SSH_PASSWORD" scp -P ${SSH_PORT:-22} \
  "/tmp/cfk-v1.9.3-${DEPLOY_DATE}.tar.gz" \
  "${SSH_USER}@${SSH_HOST}:/home/${BASE_USER}/"

# 5. Backup current staging
sshpass -p "$SSH_PASSWORD" ssh -p ${SSH_PORT:-22} \
  "${SSH_USER}@${SSH_HOST}" \
  "cd /home/${BASE_USER} && tar -czf staging-backup-${DEPLOY_DATE}.tar.gz html"

# 6. Extract
sshpass -p "$SSH_PASSWORD" ssh -p ${SSH_PORT:-22} \
  "${SSH_USER}@${SSH_HOST}" \
  "cd ${SSH_REMOTE_PATH} && tar -xzf /home/${BASE_USER}/cfk-v1.9.3-${DEPLOY_DATE}.tar.gz"

# 7. Install dependencies
sshpass -p "$SSH_PASSWORD" ssh -p ${SSH_PORT:-22} \
  "${SSH_USER}@${SSH_HOST}" \
  "cd ${SSH_REMOTE_PATH} && composer install --no-dev --optimize-autoloader"

# 8. Set permissions & clear cache
sshpass -p "$SSH_PASSWORD" ssh -p ${SSH_PORT:-22} \
  "${SSH_USER}@${SSH_HOST}" \
  "cd ${SSH_REMOTE_PATH} && chmod -R 755 . && chmod -R 777 cache && rm -rf cache/twig/*"
```

### Verify
```bash
# 9. Check deployment
curl -I https://10ce79bd48.nxcli.io/
curl -I https://10ce79bd48.nxcli.io/admin/login
```

---

## ðŸ§ª Quick Testing

```bash
# Run smoke tests
cd tests
export BASE_URL=https://10ce79bd48.nxcli.io
./smoke-test-admin-migration.sh

# Run security tests
./security-functional-tests.sh
```

---

## ðŸ”„ Quick Rollback

```bash
source .env.staging
sshpass -p "$SSH_PASSWORD" ssh -p ${SSH_PORT:-22} \
  "${SSH_USER}@${SSH_HOST}" \
  "cd /home/$(echo $SSH_USER | cut -d'_' -f1) && \
   rm -rf html && \
   tar -xzf staging-backup-${DEPLOY_DATE}.tar.gz"
```

---

## ðŸ“‹ Testing Checklist

**Critical Tests:**
- [ ] Login with magic link works
- [ ] Can add/edit child
- [ ] Sponsorships list loads
- [ ] CSV import works
- [ ] No PHP errors in log

**Browser Tests:**
- [ ] Chrome (desktop + mobile)
- [ ] Safari (desktop + mobile)
- [ ] Firefox

**Performance:**
- [ ] Homepage < 2s
- [ ] Admin dashboard < 3s
- [ ] No timeouts under load

---

## âœ… Production Ready Checklist

- [ ] All tests passing
- [ ] UAT sign-off received
- [ ] Performance acceptable
- [ ] No critical bugs
- [ ] Rollback plan tested
- [ ] Documentation complete

---

## ðŸ“ž Emergency Contacts

**Rollback:** See section above
**Support:** [Your contact]
**Hosting:** [Hosting provider]

---

**For detailed instructions, see:** `V1.9.3-STAGING-DEPLOYMENT-PLAN.md`
