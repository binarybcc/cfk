# File Usage Audit Report
## Version 1.5.1 - Phase 2

**Date:** October 13, 2025
**Branch:** v1.5.1-audit-cleanup
**Purpose:** Detailed file-by-file usage analysis with removal recommendations

---

## Summary

- **Total Files Analyzed:** 90+
- **Active Files:** 64 files ‚úÖ
- **Dead Code:** 2 files ‚ùå
- **Test Files:** 6 files üß™
- **Unused Architecture:** 19 files üö´
- **Recommended for Removal:** 27 files (30% of codebase)

---

## 1. Pages Directory (15 files)

### ‚úÖ ACTIVE - Keep All (13 files)

| File | Status | Evidence | Entry Point |
|------|--------|----------|-------------|
| `pages/home.php` | ‚úÖ Active | index.php:45 | ?page=home |
| `pages/children.php` | ‚úÖ Active | index.php:48 | ?page=children |
| `pages/child.php` | ‚úÖ Active | index.php:51 | ?page=child |
| `pages/about.php` | ‚úÖ Active | index.php:57 | ?page=about |
| `pages/donate.php` | ‚úÖ Active | index.php:60 | ?page=donate |
| `pages/sponsor.php` | ‚úÖ Active | index.php:54 | ?page=sponsor |
| `pages/sponsor_lookup.php` | ‚úÖ Active | index.php:63 | ?page=sponsor_lookup |
| `pages/sponsor_portal.php` | ‚úÖ Active | index.php:66 | ?page=sponsor_portal |
| `pages/how_to_apply.php` | ‚úÖ Active | index.php:69 | ?page=how_to_apply |
| `pages/my_sponsorships.php` | ‚úÖ Active | index.php:72 | ?page=my_sponsorships |
| `pages/confirm_sponsorship.php` | ‚úÖ Active | index.php:79 | ?page=confirm_sponsorship |
| `pages/reservation_review.php` | ‚úÖ Active | index.php:82 | ?page=reservation_review |
| `pages/reservation_success.php` | ‚úÖ Active | index.php:85 | ?page=reservation_success |

### ‚ùå REMOVE - Dead Code (2 files)

#### pages/search.php (25 lines)
**Status:** üóëÔ∏è REMOVE
**Reason:** Redundant redirect wrapper

**Evidence:**
- index.php:24-32 already handles search redirect
- File just redirects to ?page=children with search parameter
- No unique functionality
- Never reached because index.php handles it first

**Impact of Removal:** NONE - functionality preserved

**Code in file:**
```php
// Just redirects - already handled by index.php
header('Location: ' . baseUrl('?page=children&search=' . urlencode($searchQuery)));
```

---

#### pages/selections.php (418 lines)
**Status:** üóëÔ∏è REMOVE
**Reason:** Dead code - redirected before execution

**Evidence:**
- index.php:75-76 redirects ?page=selections to ?page=my_sponsorships
- Full Alpine.js implementation (418 lines) never executes
- Functionality completely moved to my_sponsorships.php
- 2 "Go Back" links in confirm_sponsorship.php reference it, but they hit the redirect

**Referenced by:**
```php
// confirm_sponsorship.php line 51 & 179
<a href="<?php echo baseUrl('?page=selections'); ?>">
// But index.php redirects this to my_sponsorships anyway
```

**Impact of Removal:** NONE - redirect remains functional

**Migration Note:** Functionality was intentionally moved to my_sponsorships.php (commit 72e1399)

---

## 2. Includes Directory (18 files)

### ‚úÖ ACTIVE - Keep All (18 files)

| File | Purpose | Used By |
|------|---------|---------|
| `includes/functions.php` | Core helpers (594 lines) | index.php + all pages |
| `includes/header.php` | Site header | index.php:40 |
| `includes/footer.php` | Site footer | index.php:92 |
| `includes/email_manager.php` | PHPMailer integration | Multiple managers |
| `includes/email_queue.php` | Email queueing | email_manager.php |
| `includes/sponsorship_manager.php` | Sponsorship workflow | 6 pages |
| `includes/reservation_functions.php` | Reservation system | my_sponsorships.php |
| `includes/reservation_emails.php` | Reservation emails | reservation pages |
| `includes/csv_handler.php` | CSV import/export | admin/import_csv.php |
| `includes/avatar_manager.php` | Avatar system | Multiple pages |
| `includes/report_manager.php` | Analytics | admin/reports.php |
| `includes/archive_manager.php` | Year-end archiving | admin/year_end_reset.php |
| `includes/backup_manager.php` | Database backups | Admin tools |
| `includes/import_analyzer.php` | CSV validation | import process |
| `includes/database_wrapper.php` | PDO wrapper | Core database |
| `includes/validator.php` | Input validation | Forms |
| `includes/components/page_header.php` | Reusable header | 5 pages |
| `includes/components/child_card.php` | Child display | children.php |

**All includes are actively used - NO REMOVALS**

---

## 3. Admin Directory (12 files)

### ‚úÖ ACTIVE - Keep All (12 files)

| File | Purpose | Access |
|------|---------|--------|
| `admin/index.php` | Dashboard | Direct |
| `admin/login.php` | Authentication | Direct |
| `admin/forgot_password.php` | Password reset | Direct |
| `admin/reset_password.php` | Password reset | Direct |
| `admin/manage_children.php` | Child management | Direct |
| `admin/manage_sponsorships.php` | Sponsorship management | Direct |
| `admin/manage_admins.php` | User management | Direct |
| `admin/import_csv.php` | Bulk import | Direct |
| `admin/reports.php` | Analytics | Direct |
| `admin/year_end_reset.php` | Archive system | Direct |
| `admin/includes/admin_header.php` | Admin header | All admin pages |
| `admin/includes/admin_footer.php` | Admin footer | All admin pages |

**All admin files are essential - NO REMOVALS**

---

## 4. Root Test Files (6 files)

### üß™ REMOVE - Development Artifacts

#### test-avatars.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** Avatar system testing
**Last Use:** Development only
**Impact:** None

#### test-dry-run.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** CSV import dry run testing
**Last Use:** Development only
**Impact:** None

#### test_email.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** Email sending test
**Last Use:** Development only
**Impact:** None

#### test_email_queue.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** Email queue testing
**Last Use:** Development only
**Impact:** None

#### test-filters.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** Filter system testing
**Last Use:** Development only
**Impact:** None

#### docs/components/button-test-examples.php
**Status:** üóëÔ∏è REMOVE
**Purpose:** Button component testing
**Location:** Wrong directory (test file in docs)
**Impact:** None

**All 6 test files are safe to remove**

---

## 5. Unused Modern Architecture (19 files)

### üö´ REMOVE - Complete Unused PSR-4 Application

**Created:** October 2, 2024 (commit cf1382c)
**Last Modified:** October 2, 2024 (never touched since)
**Reason:** Built but never integrated into active application

#### Entry Point (Never Accessed)

**public/index.php (185 lines)**
- Complete router with dependency injection
- References vendor/autoload.php (not used in active app)
- Never included or referenced by any active code
- Would require complete URL rewrite to use

#### Core Infrastructure (4 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Config/Database.php` | 101 | PDO wrapper (duplicate of includes/database_wrapper.php) |
| `src/Utils/Router.php` | 110 | URL router (not used - index.php uses query strings) |
| `src/Utils/Container.php` | 128 | DI container (not used - no dependency injection) |
| `src/Validators/ChildValidator.php` | 239 | Validation (duplicate of includes/validator.php) |

#### Controllers (2 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Controllers/ChildController.php` | 248 | Child operations (duplicate of pages logic) |
| `src/Controllers/AdminController.php` | 402 | Admin operations (duplicate of admin/ files) |

#### Models (2 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Models/Child.php` | 135 | Child entity (not used - uses arrays) |
| `src/Models/Sponsorship.php` | 133 | Sponsorship entity (not used - uses arrays) |

#### Repositories (3 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Repositories/ChildRepository.php` | 244 | Child data access (duplicate of getChildren() functions) |
| `src/Repositories/SponsorshipRepository.php` | 230 | Sponsorship data access (duplicate of sponsorship_manager.php) |
| `src/Interfaces/ChildRepositoryInterface.php` | 58 | Interface (not implemented anywhere in active code) |
| `src/Interfaces/SponsorshipRepositoryInterface.php` | 46 | Interface (not implemented anywhere in active code) |
| `src/Interfaces/SponsorshipServiceInterface.php` | 46 | Interface (not implemented anywhere in active code) |

#### Services (1 file)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Services/SponsorshipService.php` | 258 | Business logic (duplicate of sponsorship_manager.php) |

#### Security (2 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Security/CsrfManager.php` | 90 | CSRF protection (not used - uses session tokens) |
| `src/Security/RateLimiter.php` | 169 | Rate limiting (not implemented in active app) |

#### Enums (3 files)

| File | Lines | Purpose |
|------|-------|---------|
| `src/Enums/ChildStatus.php` | 50 | Status enum (not used - uses string constants) |
| `src/Enums/SponsorshipStatus.php` | 63 | Status enum (not used - uses string constants) |
| `src/Enums/SponsorshipType.php` | 51 | Type enum (not used - uses string constants) |

#### Evidence of Non-Use

```bash
# No references to any src/ classes in active code
grep -r "new Child()" includes/ admin/ pages/ = 0 results
grep -r "use CFK\\" includes/ admin/ pages/ = 0 results
grep -r "ChildRepository" includes/ admin/ pages/ = 0 results
grep -r "require.*vendor/autoload" index.php = 0 results
```

**Total to Remove:** 19 files, ~2,556 lines of unused code

---

## 6. Other Directories

### ‚úÖ Config (3 files) - Keep All

- `config/config.php` - Active configuration
- `config/config.production.php` - Production config
- `config/database.php` - PDO connection

### ‚úÖ Cron (3 files) - Keep All

- `cron/cleanup_reservations.php` - Automated cleanup
- `cron/cleanup_emails.php` - Email maintenance
- `cron/process_email_queue.php` - Email queue processing

### ‚úÖ API (2 files) - Keep All

- `api/create_reservation.php` - AJAX endpoint
- `api/get_reservation.php` - AJAX endpoint

### ‚úÖ Migrations (3 files) - Keep All

- `migrations/002_create_reservations_table.sql` - Schema migration
- `migrations/003_update_email_log_for_reservations.sql` - Schema update
- `migrations/run_migration.php` - Migration runner

### ‚úÖ Tests (4 files) - Keep (Proper Test Suite)

- `tests/Unit/ChildValidatorTest.php` - PHPUnit test
- `tests/Unit/EagerLoadingTest.php` - PHPUnit test
- `tests/Integration/SponsorshipFlowTest.php` - PHPUnit test
- `tests/bootstrap.php` - Test bootstrap
- `tests/alpine-test-page.php` - Alpine.js testing
- `tests/test-sponsor-portal.php` - Integration test

**Note:** These are proper PHPUnit tests in tests/ directory - KEEP them (different from root test-*.php files)

---

## Removal Action Plan

### Phase 3A: Low-Risk Removals (Safe to do immediately)

**Step 1: Remove Root Test Files**
```bash
git rm test-avatars.php
git rm test-dry-run.php
git rm test_email.php
git rm test_email_queue.php
git rm test-filters.php
git rm docs/components/button-test-examples.php
```

**Step 2: Remove Dead Page Files**
```bash
git rm pages/search.php
git rm pages/selections.php
```

**Commit:** "Remove dead code and test files (8 files)"

### Phase 3B: High-Risk Removal (Separate commit for rollback safety)

**Step 3: Remove Unused Architecture**
```bash
git rm -r src/
git rm public/index.php
```

**Commit:** "Remove unused PSR-4 architecture (19 files, never integrated)"

---

## File Preservation Strategy

### Archive vs Delete

**DELETE (via git rm):**
- All files listed above
- Git history preserves them forever
- Can be restored if needed

**DON'T ARCHIVE:**
- No need to move to archive/ directory
- Git is the archive
- `git show commit:file` can recover anything

---

## Verification Checklist

After removals, verify:

- [ ] All pages still accessible (?page=children, ?page=home, etc.)
- [ ] Admin dashboard loads
- [ ] Search functionality works (redirects to children page)
- [ ] My Sponsorships page works (old selections page functionality)
- [ ] Confirm Sponsorship "Go Back" links work
- [ ] CSV import works
- [ ] Email system works
- [ ] No PHP errors in logs

---

## Impact Assessment

### Code Reduction

| Category | Files Removed | Lines Removed | % Reduction |
|----------|---------------|---------------|-------------|
| Dead pages | 2 | 443 | 5% |
| Test files | 6 | ~300 | 3% |
| Unused src/ | 19 | ~2,556 | 22% |
| **TOTAL** | **27** | **~3,299** | **~30%** |

### Risk Assessment

| Risk Level | Files | Reason |
|------------|-------|--------|
| üü¢ LOW | Dead pages (2) | Already redirected in index.php |
| üü¢ LOW | Test files (6) | Development artifacts only |
| üü° MEDIUM | src/ directory (19) | Large change, but code never used |

### Benefits

‚úÖ **Clarity:** Single architecture, no confusion
‚úÖ **Maintenance:** 30% less code to maintain
‚úÖ **Onboarding:** Easier for new developers
‚úÖ **Performance:** Slightly smaller file tree
‚úÖ **Git:** Cleaner repository

---

## Conclusion

**27 files identified for safe removal** with comprehensive evidence that none are actively used in the production application.

**Recommendation:** Proceed with Phase 3 cleanup implementation.
