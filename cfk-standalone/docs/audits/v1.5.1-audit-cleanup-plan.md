# Version 1.5.1 - Audit & Cleanup Plan

**Branch:** `v1.5.1-audit-cleanup` (to be created)
**Goal:** Remove unused code, improve structure, enforce best practices
**Status:** ğŸŸ¡ Planning Phase
**Estimated Time:** 11-17 hours (2-3 days)

---

## ğŸ“‹ 6-Phase Methodology

### Phase 1: Discovery & Analysis (Read-Only, 2-3 hours)
**NO CODE CHANGES - Only analysis**

**1.1 Create Branch**
```bash
git checkout v1.5-reservation-system
git checkout -b v1.5.1-audit-cleanup
git push -u origin v1.5.1-audit-cleanup
```

**1.2 File Inventory**
- Scan all PHP files in `cfk-standalone/`
- List all pages in `pages/`
- Check for `pages/modals/` directory
- Inventory `includes/`, `admin/`, `assets/`
- Find test files in root (test-*.php, etc.)

**1.3 Dependency Mapping**
- Which files include/require others?
- Which files are entry points (accessed directly)?
- Which files are never referenced?

**1.4 Database Audit**
- Review `database/schema.sql`
- Check for unused tables/columns
- Find missing indexes
- Identify naming inconsistencies

**1.5 Code Quality Scan**
- Functions >100 lines
- Functions with >5 parameters
- Duplicate function definitions
- Commented-out code blocks
- Missing type hints

**1.6 Modal/Component Audit**
- All modal implementations
- Which modals are triggered in code
- Unused modal HTML/JS

---

### Phase 2: Generate Reports (1-2 hours)

**2.1 File Usage Report**
```
docs/audits/v1.5.1-file-usage-audit.md
```
Contents:
- âœ… Active files (with evidence)
- âš ï¸ Suspicious files (unclear usage)
- âŒ Unused files (no references)
- ğŸ“ Organization issues

**2.2 Database Audit Report**
```
docs/audits/v1.5.1-database-audit.md
```
Contents:
- Schema overview
- Unused tables/columns
- Missing indexes
- Naming issues
- Optimization recommendations

**2.3 Code Quality Report**
```
docs/audits/v1.5.1-code-quality-audit.md
```
Contents:
- Complexity metrics
- Duplicate code
- Best practice violations
- Security concerns

**2.4 Cleanup Recommendations**
```
docs/audits/v1.5.1-cleanup-recommendations.md
```
Contents:
- Prioritized list of changes
- Risk assessment
- Effort estimates

---

### Phase 3: Cleanup Implementation (4-6 hours)

**3.1 Remove Unused Files**
- Move to `archive/v1.5.0-unused/`
- Document what was removed
- Test after each removal

**3.2 Consolidate Duplicates**
- Create shared utility files
- Update all callers
- Remove duplicates

**3.3 Reorganize Structure**
**Proposed:**
```
includes/
â”œâ”€â”€ core/          # database.php, session.php, config
â”œâ”€â”€ models/        # Child.php, Family.php, Sponsorship.php
â”œâ”€â”€ managers/      # EmailManager, SponsorshipManager, etc.
â”œâ”€â”€ components/    # header.php, footer.php, modals.php
â””â”€â”€ utils/         # helpers.php, validation.php, formatting.php

pages/
â”œâ”€â”€ public/        # home.php, children.php, child.php
â”œâ”€â”€ sponsor/       # my-sponsorships.php, reservation-*.php
â””â”€â”€ info/          # about.php, how-to-apply.php, donate.php

admin/
â”œâ”€â”€ children/      # manage.php, add.php, edit.php
â”œâ”€â”€ sponsorships/  # manage.php, reports.php
â””â”€â”€ system/        # users.php, settings.php, import.php
```

**3.4 Database Cleanup**
- Remove unused columns
- Add missing indexes
- Rename inconsistent columns
- Create migration SQL

**3.5 Code Standards**
- Add missing type hints
- Remove commented code
- Add docblocks
- Fix indentation

---

### Phase 4: Testing (2-3 hours)

**4.1 Critical Path Testing**
- [ ] Child browsing
- [ ] Sponsorship selection
- [ ] Reservation flow
- [ ] Email sending
- [ ] Admin functions
- [ ] CSV import
- [ ] Reports

**4.2 Performance Check**
- Page load < 2 seconds
- Query performance
- Memory usage

**4.3 Regression Testing**
- No broken links
- No JS errors
- No PHP errors
- No missing images

---

### Phase 5: Documentation (1-2 hours)

**5.1 Update Docs**
- Architecture documentation
- File structure guide
- Component documentation

**5.2 Create Summary**
```
docs/releases/v1.5.1-cleanup-summary.md
```
Contents:
- What was removed
- What was reorganized
- Breaking changes (if any)
- Migration notes

**5.3 Update Developer Guides**
- Where files are now located
- How to add new files
- Updated coding standards

---

### Phase 6: Deployment (1 hour)

**6.1 Pull Request**
- Detailed description
- Files removed/moved list
- Testing checklist
- Migration instructions

**6.2 Merge & Tag**
1. Merge to v1.5-reservation-system
2. Tag as v1.5.1
3. Create release notes
4. Deploy to staging
5. Final production deployment

---

## ğŸ¯ Success Metrics

### Code Quality
- âœ… 20%+ reduction in file count
- âœ… Clear directory structure
- âœ… Zero unused files
- âœ… All functions documented
- âœ… PHP 8.2 strict types enforced

### Database
- âœ… No unused tables/columns
- âœ… All needed indexes present
- âœ… Consistent naming
- âœ… Queries < 100ms average

### Performance
- âœ… Page load < 2 seconds
- âœ… Optimized memory usage
- âœ… Streamlined assets

---

## ğŸ” Specific Areas to Audit

### Known Potential Issues
1. **Test files in root**: `test-*.php`, `debug-*.php`
2. **Modals**: Check if `pages/modals/` exists with unused modals
3. **Includes**: Large `functions.php` that needs splitting
4. **Database**: Potential unused columns in `families` table
5. **Assets**: Possible unused CSS/JS files

### Files to Check for Usage
```
cfk-standalone/
â”œâ”€â”€ test-avatars.php
â”œâ”€â”€ test-dry-run.php
â”œâ”€â”€ test_email_queue.php
â”œâ”€â”€ test_email.php
â”œâ”€â”€ test-filters.php
â”œâ”€â”€ phinx.php
â””â”€â”€ pages/
    â”œâ”€â”€ search.php (possibly unused?)
    â”œâ”€â”€ donate.php (check usage)
    â””â”€â”€ sponsor_lookup.php (check usage)
```

### Functions to Review
- Large functions in `includes/functions.php`
- Duplicate email functions
- Unused helper functions

---

## âš ï¸ Pre-Start Checklist

**Before starting Phase 1, confirm:**
- [ ] Question 1: Proceed with Phase 1 (Discovery)?
- [ ] Question 2: Any specific concerns or known problem areas?
- [ ] Question 3: Pause after Phase 2 reports for review?

---

## ğŸ“ Progress Tracking

### Phase Status
- [ ] Phase 1: Discovery & Analysis
- [ ] Phase 2: Generate Reports
- [ ] Phase 3: Cleanup Implementation
- [ ] Phase 4: Testing
- [ ] Phase 5: Documentation
- [ ] Phase 6: Deployment

### Current Status: Awaiting approval to begin Phase 1

---

## ğŸ”— Related Documentation

- **Main README**: `cfk-standalone/README.md`
- **Architecture**: `docs/technical/`
- **Previous Audits**: `docs/audits/`
- **Deployment Guide**: `docs/deployment/`

---

**Next Step:** Await user confirmation, then execute Phase 1 (Discovery).

**Resumption Instructions:**
When resuming, ask:
1. Should I proceed with Phase 1 (Discovery)? [Read-only analysis]
2. Any specific concerns? [Known problem areas]
3. Pause after Phase 2 reports for review? [Before making changes]
