{# Public Header Component #}
<!-- Skip Navigation Link for Keyboard Users (WCAG 2.4.1) -->
<a href="#main-content" class="skip-link">Skip to main content</a>

<header class="main-header" x-data="{ mobileMenuOpen: false, isDesktop: window.innerWidth > 968 }"
        x-init="window.addEventListener('resize', () => { isDesktop = window.innerWidth > 968 })">
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <a href="{{ baseUrl('') }}" class="logo-link">
                    <img src="{{ baseUrl('assets/images/cfk-horizontal.png') }}"
                         alt="Christmas for Kids"
                         class="logo-image"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <h1 class="logo-text-fallback" style="display:none;">Christmas for Kids</h1>
                </a>
                <p class="tagline">Bringing Christmas joy to local children in need</p>
            </div>

            <!-- Mobile Menu Toggle Button -->
            <button class="mobile-menu-toggle"
                    @click="mobileMenuOpen = !mobileMenuOpen"
                    :aria-expanded="mobileMenuOpen"
                    aria-label="Toggle navigation menu">
                <span :style="mobileMenuOpen ? 'transform: rotate(45deg) translateY(8px)' : ''"></span>
                <span :style="mobileMenuOpen ? 'opacity: 0' : ''"></span>
                <span :style="mobileMenuOpen ? 'transform: rotate(-45deg) translateY(-8px)' : ''"></span>
            </button>

            <nav class="main-nav" :class="{ 'mobile-nav-open': mobileMenuOpen }">
                <ul>
                    <li><a href="{{ baseUrl('?page=home') }}">Home</a></li>
                    <li><a href="{{ baseUrl('?page=children') }}">Children</a></li>
                    <li><a href="{{ baseUrl('?page=how_to_apply') }}">How to Apply</a></li>
                    <li class="selections-link">
                        <a href="{{ baseUrl('/reservation/review') }}" onclick="return getCartCount() > 0 || (alert('You have not selected any children yet'), false)">
                            My Selections
                            <span id="selections-badge" class="selections-badge">0</span>
                        </a>
                    </li>
                    <li><a href="{{ baseUrl('?page=about') }}">About</a></li>
                    <li class="admin-link"><a href="{{ baseUrl('admin/') }}">Admin</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<!-- ARIA Live Region for Screen Reader Announcements (WCAG 4.1.3) -->
<div id="a11y-announcements" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

<!-- Auto-hide Header on Scroll Script -->
<script>
(function() {
    let lastScrollTop = 0;
    let scrollTimer = null;
    const header = document.querySelector('.main-header');
    const scrollThreshold = 100; // Pixels to scroll before hiding

    function handleScroll() {
        // Clear previous timer
        if (scrollTimer) {
            clearTimeout(scrollTimer);
        }

        // Debounce scroll event for performance
        scrollTimer = setTimeout(function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            // Don't hide header if near top of page
            if (scrollTop < scrollThreshold) {
                header.classList.remove('header-hidden');
                lastScrollTop = scrollTop;
                return;
            }

            // Scrolling down - hide header
            if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
                header.classList.add('header-hidden');
            }
            // Scrolling up - show header
            else if (scrollTop < lastScrollTop) {
                header.classList.remove('header-hidden');
            }

            lastScrollTop = scrollTop;
        }, 10); // 10ms debounce
    }

    // Listen for scroll events
    window.addEventListener('scroll', handleScroll, { passive: true });
})();
</script>
